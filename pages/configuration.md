<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /pages/mdsource/configuration.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Configuration

## Configuring the weavers
Fody requires an XML configuration that lists all weavers to be applied to the project.

- It specifies the list of weavers that should be applied to the project.
- Weavers are applied in the order listed in the configuration. 
- Weavers can also be configured here. See the documentation of each individual weaver to see what configuration options it has.

The format is:

```xml
<Weavers>
  <WeaverA />
  <WeaverB ConfigForWeaverB="Value" />
</Weavers>
```

The `<Weavers>` element is mandatory and supports the following attributes:

 * `VerifyAssembly`: Set to `true` to run PEVerify on the build result. See [Assembly verification](#assembly-verification).
 * `VerifyIgnoreCodes`: A comma-separated list of error codes which should be ignored during assembly verification. See [Assembly verification](#assembly-verification).
 * `GenerateXsd`: Set to `false` to disable generation of the `FodyWeavers.xsd` file which provides [IntelliSense](https://docs.microsoft.com/en-us/visualstudio/ide/using-intellisense) 
   support for `FodyWeavers.xml`. This overrides the `FodyGenerateXsd` MSBuild property.

The content of the `<Weavers>` element is a list of all weavers, where the name of the element corresponds to the weaver name.

### Configuration options
There are several ways to specify the configuration

#### A file in each project directory

The default is a file named `FodyWeavers.xml` in each projects directory. 
- If this file exists, it has the highest precedence and overrides all other options.
- If it is missing, and no other configuration can be found, a default file will be created the first time the project is built.
- An XML schema will be created aside of this file, to provide [IntelliSense](https://docs.microsoft.com/en-us/visualstudio/ide/using-intellisense) support for editing the `FodyWeavers.xml`
- This file must not contain entries for weavers that are not installed. However you can omit entries if they are defined in one of the alternate configurations.

#### An MSBuild property in the project file

An alternate way is to add a property named `WeaverConfiguration` in your project file:
```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    ...
    <SomeProperty>Some Value</SomeProperty>
    <WeaverConfiguration>
      <Weavers>
        <WeaverA />
        <WeaverB ConfigForWeaverB="$(SomeProperty)" />
      </Weavers>
    </WeaverConfiguration>
  </PropertyGroup>
```
The content of this property is the same as described above
- You can use MSBuild logic to dynamically control the behavior
- You can add the configuration e.g. just once in the `Directory.build.props` file to 
  share the same configuration among several projects.
- To support sharing the configuration among several projects, entries for weavers that are not installed for a particular project are ignored, so you can configure the superset of all weavers installed in all projects.
- IntelliSens for the configuration is not available here


#### A file in the solution directory
You can also share the configuration among all projects of the solution by adding one file named `FodyWeavers.xml`
in the solution directory.
- IntelliSens for the configuration is not available here
- Entries for weavers that are not installed for a particular project are ignored, so you can configure the superset of all weavers installed in all projects.
- This option has the lowest precedence and will be overwritten by the other options


## Controlling the behavior of Fody

The following options can be set through MSBuild properties:

 * `DisableFody`: Set to `false` to disable Fody entirely.
 * `FodyGenerateXsd`: Set to `false` to disable generation of the `FodyWeavers.xsd` file which provides [IntelliSense](https://docs.microsoft.com/en-us/visualstudio/ide/using-intellisense) support for `FodyWeavers.xml`.
 * `FodyVerifyAssembly`: Enables [assembly verification](#assembly-verification) with PEVerify.


## Defining dependencies in the build order

This can be done by defining a property group project named `FodyDependsOnTargets`. The content of this property will then be passed to the `DependsOnTargets` of the Fody weaving task.

> DependsOnTargets: The targets that must be executed before this target can be executed or top-level dependency analysis can occur. Multiple targets are separated by semicolons.

An example use case of this is to force Fody to run after [CodeContracts](https://docs.microsoft.com/en-us/dotnet/framework/debug-trace-profile/code-contracts).

```xml
<PropertyGroup>
  <FodyDependsOnTargets>
    CodeContractRewrite
  </FodyDependsOnTargets>
</PropertyGroup>
```


## Assembly verification

Post build verification via [PeVerify](https://docs.microsoft.com/en-us/dotnet/framework/tools/peverify-exe-peverify-tool) is supported.

To enable do one of the following

Add `VerifyAssembly="true"` to FodyWeavers.xml:

```xml
<Weavers VerifyAssembly="true">
  <Anotar.Custom />
</Weavers>
```

Add a build constant with the value of `FodyVerifyAssembly`

To send ignore codes to PeVerify use `VerifyIgnoreCodes`.

```xml
<Weavers VerifyAssembly="true"
         VerifyIgnoreCodes="0x80131869">
  <Anotar.Custom />
</Weavers>
```
